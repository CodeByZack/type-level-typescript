import PageLayout from '../layouts/PageLayout';
import CodeEditor from '../components/CodeEditor';
import ItalicTitle from '../components/ItalicTitle';
import { PostCards } from '../components/Card';
import { tavPracticeArr } from '../practice/index';
import { PostArrary } from '../postInfos';

export const meta = {};

# Objects & Records

åœ¨ Type-level TypeScript ä¸­ï¼ŒObjects å’Œ Records æ˜¯ä¸¤ç§æœ€å¸¸ç”¨çš„**æ•°æ®ç»“æ„**ã€‚å®ƒä»¬æ˜¯æˆ‘ä»¬ type-level **ç®—æ³•**çš„åŸºç¡€ï¼Œäº†è§£å®ƒä»¬çš„å·¥ä½œåŸç†ååˆ†é‡è¦ã€‚æˆ‘èƒ½è‚¯å®šä½ æ—©å·²ä½¿ç”¨è¿‡ Objects å’Œ Records ï¼Œä½†æˆ‘å¸Œæœ›æœ¬ç« èƒ½åŠ æ·±ä½ å¯¹å®ƒä»¬ä»£è¡¨çš„æ„ä¹‰çš„**ç†è§£**ï¼Œä»¥åŠå±•ç¤ºä¸€äº›**ä¸å¸¸ç”¨çš„ä½¿ç”¨åœºæ™¯**ã€‚

```ts
type SomeObject = { key1: boolean; key2: number };

type SomeRecord = { [key: string]: number };
```

åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘å†æ¬¡æé†’ä½ ä¸€ä¸‹ï¼Œæˆ‘ä»¬[ä¸Šä¸€ç« èŠ‚](/02-types-are-just-data)è®¨è®ºè¿‡çš„é‡è¦æ¦‚å¿µã€‚åœ¨æ·±å…¥æ¢è®¨[ç±»å‹å’Œé›†åˆç†è®ºä¹‹é—´çš„å…³ç³»](/02-types-are-just-data#types-are-sets)ä¹‹å‰ï¼Œæˆ‘ä»¬ç®€è¦ä»‹ç»äº†ç±»å‹çš„**äº”ä¸ªä¸»è¦ç±»åˆ«** â€”â€” **åŸºç¡€**ç±»å‹ã€**å­—é¢é‡**ç±»å‹ã€**æ•°æ®ç»“æ„**ç±»å‹ã€**è”åˆ**ç±»å‹å’Œ**äº¤é›†**ç±»å‹ã€‚

æˆ‘ä»¬å‘ç°**ç±»å‹ä»£è¡¨ä¸€ç»„å€¼**ã€‚å°±åƒé›†åˆä¸€æ ·ï¼Œç±»å‹å¯ä»¥åŒ…å«å…¶ä»–ç±»å‹ï¼Œæˆ‘ä»¬æŠŠè¿™ç§å…³ç³»ç§°ä¹‹**å­ç±»å‹**ã€‚

![1](./img/03-objects-and-records/1.svg)

æœ€åï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä¸¤ç§ç‰¹æ®Šçš„ç±»å‹ï¼š `never` - **ç©ºé›†**ï¼Œ å’Œ `unkown` - **å…¶å®ƒæ‰€æœ‰ç±»å‹çš„è¶…é›†**ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å…³æ³¨ä¸Šä¸€ç« èŠ‚ä¸­æåˆ°çš„**å››ç§æ•°æ®ç»“æ„ç±»å‹**ä¸­çš„**ä¸¤ç§**ï¼š**Objects** å’Œ **Records** ï¼š

```ts
type FourKindsOfDataStructures =
  | { key1: boolean; key2: number } // objects
  | { [key: string]: number } // records
  | [boolean, number] // tuples
  | number[]; // arrays
```

## Object ç±»å‹

Object ç±»å‹å®šä¹‰ **JavaScript çš„å¯¹è±¡é›†åˆ**ã€‚åˆ›å»º Object ç±»å‹çš„è¯­æ³•ä¸æˆ‘ä»¬åˆ›å»ºå¸¸è§„å¯¹è±¡çš„æ–¹å¼éå¸¸ç›¸ä¼¼ï¼š

```ts
type User = {
  name: string;
  age: number;
  role: "admin" | "standard";
};
```

äº‹å®ä¸Šï¼Œå®ƒä»¬æ˜¯ JS å¯¹è±¡åœ¨ type-level çš„ç­‰ä»·ç‰©ã€‚å°±åƒ JS å¯¹è±¡ä¸€æ ·ï¼Œå®ƒå¯ä»¥åŒ…å«æˆ‘ä»¬æƒ³è¦çš„ä»»æ„æ•°é‡çš„å±æ€§ï¼Œå¹¶ä¸”æ¯ä¸ªå±æ€§éƒ½ç”±ä¸€ä¸ª**å”¯ä¸€çš„é”®**ç´¢å¼•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªé”®å¯ä»¥åŒ…å«**ä¸åŒ**çš„ç±»å‹ï¼š `name` é”®åŒ…å« `string` ç±»å‹ï¼Œ `age` é”®åŒ…å« `numner` ç±»å‹ã€‚

æˆ‘ä»¬åˆ›å»ºçš„ `User` ç±»å‹æ˜¯å…·æœ‰`name`ã€`age` å’ŒåŒ…å«æ­£ç¡®ç±»å‹å€¼çš„ `role` å±æ€§çš„æ‰€æœ‰å¯¹è±¡çš„é›†åˆï¼š

```ts
// âœ… this object is in the `User` set.
const gabriel: User = {
  name: "Gabriel",
  role: "admin",
  age: 28,
};

// âŒ
const bob: User = {
  name: "Bob",
  age: 45,
  // <- the `role` key is missing.
};

// âŒ
const peter: User = {
  name: "Peter",
  role: "standard",
  age: "45" /* <- the `age` key should be of type `number`,
                   but it's assigned to a `string`. */,
};
```

**ä½†æ˜¯å…·æœ‰é¢å¤–å±æ€§çš„å¯¹è±¡å‘¢**ï¼Ÿå®ƒä»¬å¯ä»¥åˆ†é…ç»™æˆ‘ä»¬çš„ `User` ç±»å‹å—ï¼Ÿ

å—¯ï¼Œ**å¯ä»¥â€¦â€¦ä¹Ÿä¸å¯ä»¥**ã€‚è®©æˆ‘è§£é‡Šä¸€ä¸‹ï¼

## å¯¹è±¡çš„å¯åˆ†é…æ€§

å¦‚æœæ‚¨å°è¯•å°†å¯¹è±¡åˆ†é…ç»™å…·æœ‰æ˜¾å¼ç±»å‹æ³¨é‡Šçš„å˜é‡ï¼Œå°±åƒæˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢æ‰€åšçš„é‚£æ ·ï¼ŒTypeScript å°†**æ‹’ç»**é¢å¤–çš„å±æ€§ï¼š

```ts
const alice: User = {
  name: "Alice",
  age: 35,
  role: "admin",
  bio: "...",
/* ~~~~~~~~~  
       ^  âŒ This doesn't type-check. */
};
```

è¿™æ˜¯ä½ å°†å¾—åˆ°çš„å®Œæ•´é”™è¯¯ï¼š

```ts
Object literal may only specify known properties, and 'bio' does not exist in type 'User'. (2322)
```

**å¯¹è±¡å­—é¢é‡**æŒ‡çš„æ˜¯ä½ ä½¿ç”¨å¤§æ‹¬å· `{}` è¯­æ³•**å…§è”**å®šä¹‰çš„å¯¹è±¡ã€‚

å¦‚æœæˆ‘ä»¬å°†å…·æœ‰é¢å¤–å±æ€§çš„ï¼Œ**é¢„å…ˆå®šä¹‰å¥½çš„**å¯¹è±¡èµ‹å€¼ç»™ `alice` ä¼šæŠ¥é”™å—ï¼Ÿ

```ts
const looksLikeAUser = {
  name: "Alice",
  age: 35,
  role: "admin" as const,
  bio: "...", // <- extra prop!
};

// âœ… This works just fine!
const alice: User = looksLikeAUser;
```

TypeScript ä¸ä¼šæŠ¥é”™ã€‚

æ‰€ä»¥æœ€ç»ˆçš„ç­”æ¡ˆæ˜¯**å…·æœ‰é¢å¤–å±æ€§çš„å¯¹è±¡å¯ä»¥åˆ†é…ç»™å…·æœ‰æ›´å°‘å±æ€§çš„å¯¹è±¡**ï¼Œä½†æ˜¯åœ¨**å¯¹è±¡è¢«å†…è”å®šä¹‰**çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒTypeScript æœ‰**é¢å¤–çš„è§„åˆ™**æ¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šé”™è¯¯åœ°åˆ†é…æˆ‘ä»¬ä¹‹åæ— æ³•ä½¿ç”¨çš„å±æ€§ï¼Œå› ä¸ºç±»å‹æ£€æŸ¥ä¼šç¦æ­¢æˆ‘ä»¬è¿™æ ·åšã€‚

![2](./img/03-objects-and-records/2.svg)

è¿™æ„å‘³ç€ï¼Œä½ **ä¸èƒ½ä¿è¯**æŸç§ç±»å‹çš„å¯¹è±¡**ä¸åŒ…å«**é¢å¤–çš„å±æ€§ï¼[^1] ä¸€ä¸ª Object ç±»å‹æ˜¯ä¸€ä¸ª**è‡³å°‘**åŒ…å«å®ƒæ‰€å®šä¹‰çš„æ‰€æœ‰å±æ€§çš„å¯¹è±¡çš„é›†åˆã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ï¼Œå¯ä»¥ç”¨ type-level çš„å¯¹è±¡åšäº›ä»€ä¹ˆï¼Ÿ

## è¯»å–å±æ€§

è¦è®¿é—®ä¸€ä¸ªå±æ€§çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·ï¼š

```ts
type User = { name: string; age: number; role: "admin" | "standard" };

type Age = User["age"]; // => number
type Role = User["role"]; // => "admin" | "standard"
```

ä½†æ˜¯ç‚¹ä¸ä¼šèµ·ä½œç”¨ï¼

```ts
type Age = User.age;
//             ^ âŒ syntax error!
```

æ²¡å…³ç³»ã€‚æ— è®ºå¦‚ä½•ï¼Œæ–¹æ‹¬å·è¡¨ç¤ºæ³•å’Œç‚¹è¡¨ç¤ºæ³•åœ¨ value-level ä¸Šæ˜¯ç­‰ä»·çš„ã€‚

## ä¸€æ¬¡è¯»å–å¤šä¸ªå±æ€§

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ `User["age"]` ç­‰è¡¨è¾¾å¼ä¸­ï¼Œé”® (`"age"`) æ˜¯[**å­—é¢é‡ç±»å‹**](/02-types-are-just-data#literal-types)ã€‚å¦‚æœæ‚¨å°è¯•ä½¿ç”¨**è”åˆç±»å‹**ï¼Œä½ è®¤ä¸ºä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

```ts
type User = { name: string; age: number; role: "admin" | "standard" };

type NameOrAge = User["name" | "age"]; // => string | number
```

å—¯ï¼Œå®ƒæ˜¯æœ‰æ•ˆçš„ï¼å°±å¥½åƒæˆ‘ä»¬**åŒæ—¶**è®¿é—® `"name"` å’Œ `"age"` å±æ€§ä¸€æ ·ï¼Œç„¶åä¼šå¾—åˆ°ä¸€ä¸ªåŒ…å«å®ƒä»¬çš„ç±»å‹çš„è”åˆç±»å‹ã€‚ä»ä¸€ä¸ªå¯¹è±¡è®¿é—®å¤šä¸ªå±æ€§ç›¸å½“äºåˆ†åˆ«è®¿é—®æ¯ä¸ªå±æ€§ï¼Œç„¶åç”¨å®ƒä»¬çš„ç»“æœæ„é€ ä¸€ä¸ªè”åˆç±»å‹ï¼š

```ts
type NameOrAge = User["name"] | User["age"]; // => string | number
```

åªæ˜¯å˜å¾—æ›´ç®€æ´äº†ï¼[^2]


## `keyof` å…³é”®å­—


`keyof` å…³é”®å­—å¯ä»¥è®©ä½ è·å–å¯¹è±¡ç±»å‹ä¸­**æ‰€æœ‰å±æ€§**çš„è”åˆã€‚å®ƒå¯ä»¥æ”¾åœ¨ä»»ä½•å¯¹è±¡ä¹‹å‰ï¼š

```ts
type User = {
  name: string;
  age: number;
  role: "admin" | "standard";
};

type Keys = keyof User; // "name" | "age" | "role"
```

ç”±äº `keyof` è¿”å›å­—ç¬¦ä¸²ç±»å‹çš„**è”åˆ**ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä¸æ–¹æ‹¬å·ç¬¦å·ç»“åˆèµ·æ¥ä»¥è·å–æ­¤å¯¹è±¡ä¸­**æ‰€æœ‰å€¼**çš„ç±»å‹çš„è”åˆï¼

```ts
type User = {
  name: string;
  age: number;
  role: "admin" | "standard";
};

type UserValues = User[keyof User]; //  string | number | "admin" | "standard"
```

è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬ç»å¸¸å®šä¹‰ä¸€ä¸ª `ValueOf` **æ³›å‹ç±»å‹**æ¥æŠ½è±¡è¿™ä¸ªæ¨¡å¼ï¼š

```ts
type ValueOf<Obj> = Obj[keyof Obj];

type UserValues = ValueOf<User>; //  string | number | "admin" | "standard"
```

æ³›å‹æ˜¯ **type-level å‡½æ•°**ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä»»ä½•å¯¹è±¡ç±»å‹é‡ç”¨è¿™ä¸ªé€»è¾‘ï¼ ğŸ‰


## å¯é€‰å±æ€§

å¯¹è±¡ç±»å‹å¯ä»¥å®šä¹‰å¯é€‰çš„å±æ€§ã€‚å°†å±æ€§è®¾ç½®ä¸ºå¯é€‰çš„æ–¹æ³•æ˜¯ä½¿ç”¨ `?:` é”®ä¿®é¥°ç¬¦ï¼š

```ts
type BlogPost = { title: string; tags?: string[] };
//                                   ^ this property is optional!

// âœ… No `tags` property
const blogBost1: BlogPost = { title: "introduction" };

// âœ… `tags` contains a list of strings
const blogBost2: BlogPost = {
  title: "part 1",
  tags: ["#easy", "#beginner-friendly"],
};
```

But why do we need some special syntax where it looks like a union type like T | undefined would do the trick?

ä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€äº›ç‰¹æ®Šçš„è¯­æ³•ï¼Œå®ƒçœ‹èµ·æ¥åƒè”åˆç±»å‹ï¼Œå¦‚ `T | undefined` ä¼šè®©ä¸Šé¢çš„ä»£ç é€šè¿‡ç±»å‹æ£€æŸ¥å—ï¼Ÿ

```ts
type BlogPost = { title: string; tags: string[] | undefined };
```

è¿™æ˜¯å› ä¸ºå¯¹è±¡å¿…é¡»ä¸ºå…¶ç±»å‹ä¸­å­˜åœ¨çš„æ‰€æœ‰é”®å®šä¹‰å€¼ã€‚ TypeScript ä¼šè¦æ±‚æˆ‘ä»¬æ˜¾å¼åœ°ä¸º undefined åˆ†é…ä¸€ä¸ªæ ‡ç­¾é”®ï¼š


<CodeEditor
  height={500}
  defaultValue={[tavPracticeArr[13], tavPracticeArr[14]]}
/>

[^1]: This is why Object.keys(...) returns a string[] and not a (keyof Obj)[] by the way. (keyof Obj)[] would be incorrect because Object.keys(...) could return strings that are not assignable to keyof Obj.

[^2]: The real reason why it's possible to read several properties at once using a union type is because the type level expression User["name"] and the value level expression user["name"] work differently. Instead of finding the key equal to "name" in the type User, TypeScript tries to find every key in User that is assignable to the type "name"!
If we write User["name" | "age"], TS will find all keys assignable to the type "name" | "age" and return their value types. Pretty cool right?

export default ({ children }) => (
  <PageLayout prev={PostArrary[0]} next={PostArrary[2]} meta={meta}>
    {children}
  </PageLayout>
);
